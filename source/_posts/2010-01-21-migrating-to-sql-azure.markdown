---
layout: post
title: "Migrating to SQL Azure "
description: "So, I have myself a database in the cloud but it wasn't plain sailing migrating from an existing database.I used SQL Server Management Studio to generate the whole schema as a script and attempted to run this on the cloud DB. As expected it didn't..."
date: 2010-01-21 00:00
comments: true
author: Adam
categories: [azure]
---

So, I have myself a database in the cloud but it wasn't plain sailing migrating from an existing database.<p /><div>I used SQL Server Management Studio to generate the whole schema as a script and attempted to run this on the cloud DB. As expected it didn't work.&nbsp;</div><p /><div>Here's what I had to change:</div><p /><div><div>- Removed all Database creation and settings</div><div>- Removed all Schema and Role creations</div><div>- Stripped out the following index and table options: PAD INDEX,&nbsp;ALLOW_ROW_LOCKS,&nbsp;SORT_IN_TEMPDB, &nbsp;ALLOW_PAGE_LOCKS, TEXTIMAGE_ON</div><div>- Removed all references to the file groups, ie [PRIMARY]</div><div>- Removed all instances of [dbo] referencing. This was actually to resolve an error with some aspnet db views containing three-part column names</div><div>- Added WITH (NOLOCK) to all table references that just had (NOLOCK), again aspnet db views.</div><div>- Populated the aspnet_schemaversions table as follows:</div><p /><div><div style=""><span style="color: #0000ff;">INSERT</span> aspnet_SchemaVersions<span style="color: #0000ff;"> </span><span style="color: #929292;">(</span>Feature<span style="color: #929292;">,</span> CompatibleSchemaVersion<span style="color: #929292;">,</span> IsCurrentVersion<span style="color: #929292;">)</span></div><div style=""><span style="color: #0000ff;">VALUES </span><span style="color: #929292;">(</span>'common'<span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">)</span></div><p /><div style=""><span style="color: #0000ff;">INSERT</span> aspnet_SchemaVersions<span style="color: #0000ff;"> </span><span style="color: #929292;">(</span>Feature<span style="color: #929292;">,</span> CompatibleSchemaVersion<span style="color: #929292;">,</span> IsCurrentVersion<span style="color: #929292;">)</span></div><div style=""><span style="color: #0000ff;">VALUES </span><span style="color: #929292;">(</span>'health monitoring'<span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">)</span></div><p /><div style=""><span style="color: #0000ff;">INSERT</span> aspnet_SchemaVersions<span style="color: #0000ff;"> </span><span style="color: #929292;">(</span>Feature<span style="color: #929292;">,</span> CompatibleSchemaVersion<span style="color: #929292;">,</span> IsCurrentVersion<span style="color: #929292;">)</span></div><div style=""><span style="color: #0000ff;">VALUES </span><span style="color: #929292;">(</span>'membership'<span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">)</span></div><p /><div style=""><span style="color: #0000ff;">INSERT</span> aspnet_SchemaVersions<span style="color: #0000ff;"> </span><span style="color: #929292;">(</span>Feature<span style="color: #929292;">,</span> CompatibleSchemaVersion<span style="color: #929292;">,</span> IsCurrentVersion<span style="color: #929292;">)</span></div><div style=""><span style="color: #0000ff;">VALUES </span><span style="color: #929292;">(</span>'personalization'<span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">)</span></div><p /><div style=""><span style="color: #0000ff;">INSERT</span> aspnet_SchemaVersions<span style="color: #0000ff;"> </span><span style="color: #929292;">(</span>Feature<span style="color: #929292;">,</span> CompatibleSchemaVersion<span style="color: #929292;">,</span> IsCurrentVersion<span style="color: #929292;">)</span></div><div style=""><span style="color: #0000ff;">VALUES </span><span style="color: #929292;">(</span>'profile'<span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">)</span></div><p /><div style=""><span style="color: #0000ff;">INSERT</span> aspnet_SchemaVersions<span style="color: #0000ff;"> </span><span style="color: #929292;">(</span>Feature<span style="color: #929292;">,</span> CompatibleSchemaVersion<span style="color: #929292;">,</span> IsCurrentVersion<span style="color: #929292;">)</span></div><div style=""><span style="color: #0000ff;">VALUES </span><span style="color: #929292;">(</span>'role manager'<span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">,</span><span style="color: #000000;"> 1</span><span style="color: #929292;">)</span></div></div><p /><p /><p /></div>